/*
*
* Copyright (c) 2022 Rafael Rom√£o
* SPDX-License-Identifier: MIT
*
*/

/ {
    #define SYMBOL(NAME, SYMBOLS) \
        NAME: NAME { \
            compatible = "zmk,behavior-macro"; \
            #binding-cells = <0>; \
            wait-ms = <0>; \
            tap-ms = <0>; \
            bindings = <&macro_tap SYMBOLS>; \
        };

    #define SHIFTED_SYMBOL(NAME, UNSHIFTED, SHIFTED) \
        NAME: NAME { \
            compatible = "zmk,behavior-mod-morph"; \
            #binding-cells = <0>; \
            bindings = <UNSHIFTED>, <SHIFTED>; \
            mods = <(MOD_LSFT|MOD_RSFT)>; \
        };

    #define MORPHED_NUM_MEH(NAME, UNMORPHED, MORPHED) \
        NAME##num: NAME##num { \
            compatible = "zmk,behavior-mod-morph"; \
            #binding-cells = <0>; \
            bindings = <UNMORPHED>, <MORPHED>; \
            mods = <(MOD_LSFT|MOD_RSFT)>; \
        }; \
        NAME##sft: NAME##sft { \
            compatible = "zmk,behavior-mod-morph"; \
            #binding-cells = <0>; \
            bindings = <&NAME##num>, <MORPHED>; \
            mods = <(MOD_LSFT)>; \
            keep-mods = <(MOD_LSFT)>; \
        }; \
        NAME##ctl: NAME##clt { \
            compatible = "zmk,behavior-mod-morph"; \
            #binding-cells = <0>; \
            bindings = <&NAME##num>, <&NAME##sft>; \
            mods = <(MOD_LCTL)>; \
            keep-mods = <(MOD_LCTL)>; \
        }; \
        NAME: NAME { \
            compatible = "zmk,behavior-mod-morph"; \
            #binding-cells = <0>; \
            bindings = <&NAME##num>, <&NAME##ctl>; \
            mods = <(MOD_LALT)>; \
            keep-mods = <(MOD_LALT)>; \
        };

    #define TAPHOLD_SYMBOL(NAME, TAP, HOLD) \
         NAME: NAME { \
            compatible = "zmk,behavior-hold-tap"; \
            #binding-cells = <2>; \
            tapping-term-ms = <TAPPING_TERM>; \
            flavor = "tap-preferred"; \
            quick-tap-ms = <QUICK_TAP_TERM>; \
            require-prior-idle-ms = <QUICK_TAP_TERM>; \
            bindings = <HOLD>, <TAP>; \
        };

    #define LAYERTAP_HP_SYMBOL(NAME, BINDINGS) \
         NAME: NAME { \
            compatible = "zmk,behavior-hold-tap"; \
            #binding-cells = <2>; \
            tapping-term-ms = <TAPPING_TERM>; \
            flavor = "hold-preferred"; \
            quick-tap-ms = <QUICK_TAP_TERM>; \
            bindings = <&mo>, <BINDINGS>; \
        };

    #define LAYERTAP_SYMBOL(NAME, BINDINGS) \
         NAME: NAME { \
            compatible = "zmk,behavior-hold-tap"; \
            #binding-cells = <2>; \
            tapping-term-ms = <TAPPING_TERM>; \
            flavor = "tap-preferred"; \
            quick-tap-ms = <QUICK_TAP_TERM>; \
            require-prior-idle-ms = <QUICK_TAP_TERM>; \
            bindings = <&mo>, <BINDINGS>; \
        };

    #define MACRO_SYMBOL(NAME, SYMBOLS) \
        NAME: NAME { \
			compatible = "zmk,behavior-macro"; \
            #binding-cells = <0>; \
            wait-ms = <10>; \
            tap-ms = <10>; \
            bindings = <&macro_tap SYMBOLS>; \
        };

    symbols {
        // Base

        SHIFTED_SYMBOL(mm_semi,    &kp SEMI, &kp COLON)
        SYMBOL(mc_end_semi,        &kp END &kp SEMI)
        TAPHOLD_SYMBOL(th_semi,    &mm_semi, &mc_end_semi)

        SYMBOL(mc_meh_space,             &kp LS(LC(LA(SPACE))))
        SYMBOL(mc_hyper_space,           &kp LS(LC(LA(LG(SPACE)))))
        TAPHOLD_SYMBOL(th_hyper_space,   &mc_hyper_space, &mc_hyper)

        SYMBOL(mc_end_semi_ent,          &kp END &kp SEMI &kp ENTER)
        TAPHOLD_SYMBOL(th_end_semi_ent,  &mc_end_semi_ent, &mc_hyper)

        SYMBOL(mc_comma,            &kp COMMA)
        LAYERTAP_HP_SYMBOL(th_comma, &mm_comma_meh)

        SYMBOL(mc_dot,             &kp DOT &sl SEN_CASE)
        SYMBOL(mc_end_dot,         &kp END &kp DOT &sl SEN_CASE)
        TAPHOLD_SYMBOL(th_dot,     &mm_dot_meh, &mc_end_dot)

        // Lower

        MORPHED_NUM_MEH(mc_n0,      &kp N0, &kp KP_N0)
        MORPHED_NUM_MEH(mc_n1,      &kp N1, &kp KP_N1)
        MORPHED_NUM_MEH(mc_n2,      &kp N2, &kp KP_N2)
        MORPHED_NUM_MEH(mc_n3,      &kp N3, &kp KP_N3)
        MORPHED_NUM_MEH(mc_n4,      &kp N4, &kp KP_N4)
        MORPHED_NUM_MEH(mc_n5,      &kp N5, &kp KP_N5)
        MORPHED_NUM_MEH(mc_n6,      &kp N6, &kp KP_N6)
        MORPHED_NUM_MEH(mc_n7,      &kp N7, &kp KP_N7)
        MORPHED_NUM_MEH(mc_n8,      &kp N8, &kp KP_N8)
        MORPHED_NUM_MEH(mc_n9,      &kp N9, &kp KP_N9)

        LAYERTAP_SYMBOL(th_n0,     &mc_n0)

        SYMBOL(mc_sqo,             &kp SQT &kp SPACE &kp SQUO_TERM)
        SYMBOL(mc_end_sqo,         &kp END &mc_sqo)
        TAPHOLD_SYMBOL(th_sqo,     &mc_sqo, &mc_end_sqo)

        SYMBOL(mc_sqo_c,           &kp SQT &kp SPACE &kp C_SQUO_TERM)
        SYMBOL(mc_end_sqo_c,       &kp END &mc_sqo_c)
        TAPHOLD_SYMBOL(th_sqo_c,   &mc_sqo_c, &mc_end_sqo_c)

        SYMBOL(mc_dqo,             &kp DQT &kp SPACE)
        SYMBOL(mc_end_dqo,         &kp END &mc_dqo)
        TAPHOLD_SYMBOL(th_dqo,     &mc_dqo, &mc_end_dqo)

        SYMBOL(mc_bti,             &kp GRAVE &kp SPACE)
        SYMBOL(mc_end_bti,         &kp END &mc_bti)
        TAPHOLD_SYMBOL(th_bti,     &mc_bti, &mc_end_bti)

        SYMBOL(mc_tilde,           &kp TILDE &kp SPACE)
        LAYERTAP_SYMBOL(th_tilde,  &mc_tilde)

        SYMBOL(mc_and,             &kp AMPS &kp AMPS)
        SYMBOL(mc_right_and,       &kp RIGHT &kp AMPS &kp AMPS)
        TAPHOLD_SYMBOL(th_and,     &mc_and, &mc_right_and)

        SYMBOL(mc_or,              &kp PIPE &kp PIPE)
        SYMBOL(mc_right_or,        &kp RIGHT &kp PIPE &kp PIPE)
        TAPHOLD_SYMBOL(th_or,      &mc_or, &mc_right_or)

        SYMBOL(mc_rpar,            &kp RPAR)
        SYMBOL(mc_end_rpar,        &kp END &kp RPAR)
        TAPHOLD_SYMBOL(th_rpar,    &mc_rpar, &mc_end_rpar)

        SYMBOL(mc_lpar,            &kp LPAR)
        SYMBOL(mc_end_lpar,        &kp END &kp LPAR)
        TAPHOLD_SYMBOL(th_lpar,    &mc_lpar, &mc_end_lpar)

        SYMBOL(mc_rbkt,            &kp RBKT)
        SYMBOL(mc_end_rbkt,        &kp END &kp RBKT)
        TAPHOLD_SYMBOL(th_rbkt,    &mc_rbkt, &mc_end_rbkt)

        SYMBOL(mc_lbkt,            &kp LBKT)
        SYMBOL(mc_end_lbkt,        &kp END &kp LBKT)
        TAPHOLD_SYMBOL(th_lbkt,    &mc_lbkt, &mc_end_lbkt)

        SYMBOL(mc_qmark,           &kp QMARK &sl SEN_CASE)
        SYMBOL(mc_end_qmark,       &kp END &kp QMARK &sl SEN_CASE)
        TAPHOLD_SYMBOL(th_qmark,   &mc_qmark, &mc_end_qmark)

        SYMBOL(mc_rbrc,            &kp RBRC)
        SYMBOL(mc_end_rbrc,        &kp END &kp RBRC)
        TAPHOLD_SYMBOL(th_rbrc,    &mc_rbrc, &mc_end_rbrc)

        SYMBOL(mc_lbrc,            &kp LBRC)
        SYMBOL(mc_end_lbrc,        &kp END &kp LBRC)
        TAPHOLD_SYMBOL(th_lbrc,    &mc_lbrc, &mc_end_lbrc)

        SYMBOL(mc_pars,            &kp LPAR &kp RPAR)
        SYMBOL(mc_end_pars,        &kp END &kp LPAR &kp RPAR)
        TAPHOLD_SYMBOL(th_pars,    &mc_pars, &mc_end_pars)

        SYMBOL(mc_brackets,          &kp LBKT &kp RBKT)
        LAYERTAP_SYMBOL(th_brackets, &mc_brackets)

        SYMBOL(mc_deg,               &kp LS(LA(N8)))
        LAYERTAP_SYMBOL(th_deg,      &mc_deg)

        // Raise

        SYMBOL(mc_us,              &kp LS(U) &kp LS(S) &kp DOLLAR)
        SYMBOL(mc_usd,             &kp LS(U) &kp LS(S) &kp LS(D))
        TAPHOLD_SYMBOL(th_us,      &mc_us, &mc_usd)
        SYMBOL(mc_br,              &kp LS(R) &kp DOLLAR)
        SYMBOL(mc_brl,             &kp LS(B) &kp LS(R) &kp LS(L))
        TAPHOLD_SYMBOL(th_br,      &mc_br, &mc_brl)
        SYMBOL(mc_euro,            &kp LS(LA(N2)))
        SYMBOL(mc_eur,             &kp LS(E) &kp LS(U) &kp LS(R))
        TAPHOLD_SYMBOL(th_eur,     &mc_euro, &mc_eur)

        SYMBOL(mc_pars_semi_ent,   &kp END &kp LPAR &kp RPAR &kp SEMI &kp ENTER)

        SYMBOL(mc_dhash,           &kp HASH &kp HASH)
        SYMBOL(mc_thash,           &kp HASH &kp HASH &kp HASH)
        SYMBOL(mc_tdqo,            &mc_dqo &mc_dqo &mc_dqo)
        SYMBOL(mc_tdqo_ent,        &mc_tdqo &kp ENTER)
        TAPHOLD_SYMBOL(th_tdqo,    &mc_tdqo, &mc_tdqo_ent)

        SYMBOL(mc_tbti,            &mc_bti &mc_bti &mc_bti)
        SYMBOL(mc_tbti_ent,        &mc_tbti &kp ENTER)
        TAPHOLD_SYMBOL(th_tbti,    &mc_tbti, &mc_tbti_ent)
        SYMBOL(mc_dsqo,            &mc_sqo &mc_sqo &kp LEFT)
        SYMBOL(mc_ddqo,            &mc_dqo &mc_dqo &kp LEFT)
        SYMBOL(mc_dbti,            &mc_bti &mc_bti &kp LEFT)

        SYMBOL(mc_braces_new,      &kp END &kp LBRC &kp ENTER)
        SYMBOL(mc_sarrow,          &kp MINUS &kp GT)
        SYMBOL(mc_darrow,          &kp EQUAL &kp GT)
        SYMBOL(mc_dcolon,          &kp COLON &kp COLON)
        SYMBOL(mc_end_dcolon,      &kp END &kp COLON &kp COLON)
        TAPHOLD_SYMBOL(th_dcolon,  &mc_dcolon, &mc_end_dcolon)

        SYMBOL(mc_perc,            &kp PERCENT)
        SYMBOL(mc_end_perc,        &kp END &kp PERCENT)
        TAPHOLD_SYMBOL(th_perc,    &mc_perc, &mc_end_perc)

        SYMBOL(mc_lt,              &kp LT)
        SYMBOL(mc_gt,              &kp GT)

        SYMBOL(mc_excl,            &kp EXCL &sl SEN_CASE)
        SYMBOL(mc_end_excl,        &kp END &kp EXCL &sl SEN_CASE)
        TAPHOLD_SYMBOL(th_excl,    &mc_excl, &mc_end_excl)

        SYMBOL(mc_colon,           &kp COLON)
        SYMBOL(mc_end_colon,       &kp END &kp COLON)
        TAPHOLD_SYMBOL(th_colon,   &mc_colon, &mc_end_colon)

        SYMBOL(mc_eql,             &kp EQUAL)
        SYMBOL(mc_end_eql,         &kp END &kp EQUAL)
        TAPHOLD_SYMBOL(th_eql,     &mc_eql, &mc_end_eql)
        SYMBOL(mc_eqeq,            &kp EQUAL &kp EQUAL)

        SYMBOL(mc_noteq,           &kp EXCL &kp EQUAL)

        SYMBOL(mc_tisl,            &kp TILDE &kp SPACE &kp SLASH)
        SYMBOL(mc_dds,             &kp DOT &kp DOT &kp SLASH)
        SYMBOL(mc_ds,              &kp DOT &kp SLASH)
        SYMBOL(mc_spc_esc,         &kp J &macro_press &kp SPACE &macro_pause_for_release &macro_release &kp SPACE &macro_tap &kp ESC)
        SYMBOL(mc_dqt0p,           &kp DQT &kp N0 &kp P)

        SYMBOL(mc_ord_o,           &kp LA(N0))
        SYMBOL(mc_ord_a,           &kp LA(N9))
        TAPHOLD_SYMBOL(th_ord_o,     &mc_ord_o, &mc_meh)
        TAPHOLD_SYMBOL(th_ord_a,     &mc_ord_a, &mc_hyper)

        // SMARTCASES

        SYMBOL(mc_comma_space,     &kp COMMA &kp SPACE)

        // Vim home home

        mc_caret: mc_caret {
            compatible = "zmk,behavior-macro";
            label = "mc_caret";
            #binding-cells = <0>;
            wait-ms = <0>;
            tap-ms = <0>;
            bindings = <&macro_tap &kp CARET &kp SPACE &kp CARET_TERM>;
        };

        mc_zero: mc_zero {
            compatible = "zmk,behavior-macro";
            label = "mc_zero";
            #binding-cells = <0>;
            wait-ms = <0>;
            tap-ms = <0>;
            bindings = <&macro_tap &kp N0>;
        };

        vim_home: vim_home {
            compatible = "zmk,behavior-antecedent-morph";
            label = "vim_home";
            #binding-cells = <0>;
            max-delay-ms = <600>;
            defaults = <&mc_caret>;
            antecedents = <CARET_TERM>;
            bindings = <&mc_zero>;
        };

        TAPHOLD_SYMBOL(th_caret_z, &vim_home, &mc_zero)

    };
};
