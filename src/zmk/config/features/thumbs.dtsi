/*
*
* Copyright (c) 2022 Rafael Rom√£o
* SPDX-License-Identifier: MIT
*
*/

/ {
    #define THUMB_LAYERTAP(NAME, BINDINGS) \
         NAME: NAME { \
            compatible = "zmk,behavior-hold-tap"; \
            label = ZMK_MACRO_STRINGIFY(NAME); \
            #binding-cells = <2>; \
            tapping-term-ms = <TAPPING_TERM>; \
            flavor = "tap-preferred"; \
            quick-tap-ms = <QUICK_TAP_TERM>; \
            require-prior-idle-ms = <QUICK_TAP_TERM>; \
            bindings = <&mo>, <BINDINGS>; \
        };

    #define THUMB_MACRO(NAME, BINDINGS) \
        NAME: NAME { \
			compatible = "zmk,behavior-macro"; \
            label = ZMK_MACRO_STRINGIFY(NAME); \
            #binding-cells = <0>; \
            wait-ms = <10>; \
            tap-ms = <10>; \
            bindings = <&macro_tap BINDINGS>; \
        };

    thumbs {
        smart_case: smart_case {
            compatible = "zmk,behavior-caps-word";
            label = ZMK_MACRO_STRINGIFY(smart_case);
            ignore-alphas;
            ignore-modifiers;
			#binding-cells = <0>;  
            layers = <CASE_A1>;
            continue-list = <UNDERSCORE MINUS BACKSPACE DELETE SQT TILDE CARET GRAVE>;
        };

        THUMB_MACRO(tc_smart_num,     &to ALPHA1 &smart_num)
        THUMB_MACRO(tc_cancel,        &kp K_CANCEL)
        THUMB_MACRO(tc_sp_ns,         &kp SPACE &sl SEN_E1)
        THUMB_MACRO(tc_nsen,          &sl SEN_E1)
        THUMB_LAYERTAP(th_sp_ns,      &tc_sp_ns)
        THUMB_LAYERTAP(th_cancel,     &tc_cancel)
        THUMB_LAYERTAP(th_nsen,       &tc_nsen)

        shift_smart_case: shift_smart_case {
            compatible = "zmk,behavior-mod-morph";
            label = ZMK_MACRO_STRINGIFY(shift_smart_case);
            #binding-cells = <0>;
            bindings = <&sk LSHFT>, <&smart_case>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };

        ht_repeat: ht_repeat {
            compatible = "zmk,behavior-hold-tap";
            label = ZMK_MACRO_STRINGIFY(ht_repeat);
            #binding-cells = <2>;
            tapping-term-ms = <TAPPING_TERM>;
            flavor = "tap-preferred";
            quick-tap-ms = <QUICK_TAP_TERM>;
            bindings = <&mo>, <&smart_shift_repeat>;
        };
        smart_shift_repeat: smart_shift_repeat {
            compatible = "zmk,behavior-antecedent-morph";
            label = ZMK_MACRO_STRINGIFY(smart_shift_repeat);
            #binding-cells = <0>;
            max-delay-ms = <ADAPTIVE_KEY_TIMEOUT>;
            defaults = <&shift_smart_case>;
            antecedents = <A           B           C           D           E           F           G           H           \
                           I           J           K           L           M           N           O           P           \
                           Q           R           S           T           U           V           W           X           \
                           Y           Z           >;
            bindings =    <&tc_and     &key_repeat &key_repeat &key_repeat &key_repeat &key_repeat &key_repeat &ac_aacu    \
                           &tc_ng      &ac_aacu    &tc_key     &key_repeat &key_repeat &key_repeat &key_repeat &key_repeat \
                           &key_repeat &key_repeat &key_repeat &key_repeat &key_repeat &tc_ver     &tc_which   &key_repeat \
                           &tc_you     &key_repeat >;
        };
        THUMB_MACRO(tc_and,     &kp N &kp D)
        THUMB_MACRO(tc_you,     &kp O &kp U)
        THUMB_MACRO(tc_ng,      &kp N &kp G)
        THUMB_MACRO(tc_key,     &kp E &kp Y)
        THUMB_MACRO(tc_ver,     &kp E &kp R)
        THUMB_MACRO(tc_which,   &kp H &kp I &kp C &kp H)
        THUMB_MACRO(tc_cdilao,  &ac_atil &kp O)
        THUMB_MACRO(tc_dotcom,  &kp C &kp O &kp M)
        THUMB_MACRO(tc_aacuv,   &kp V)
        THUMB_MACRO(tc_eacuv,   &kp V)
        THUMB_MACRO(tc_iacuv,   &kp V)
        THUMB_MACRO(tc_oacuv,   &kp V)
        THUMB_MACRO(tc_uacuv,   &kp V)

        ht_magic: ht_magic {
            compatible = "zmk,behavior-hold-tap";
            label = ZMK_MACRO_STRINGIFY(ht_sc);
            #binding-cells = <2>;
            tapping-term-ms = <TAPPING_TERM>;
            flavor = "tap-preferred";
            quick-tap-ms = <QUICK_TAP_TERM>;
            bindings = <&mo>, <&smart_shift_magic>;
        };
        smart_shift_magic: smart_shift_magic {
            compatible = "zmk,behavior-antecedent-morph";
            label = ZMK_MACRO_STRINGIFY(smart_shift_magic);
            #binding-cells = <0>;
            max-delay-ms = <ADAPTIVE_KEY_TIMEOUT>;
            defaults = <&shift_smart_case>;
            antecedents = <A           B           C           D           E           F           G           \
                           I           J           K           L           M           N           P           \
                           Q           R           S           T           U           V           W           \
                           X           Z           >;
            bindings =    <&kp O       &kp Y       &kp S       &kp Y       &kp U       &kp Y       &kp U       \
                           &tc_smart_i &ac_aacu    &kp W       &kp H       &kp S       &kp F       &kp T       \
                           &tc_qmk     &kp H       &kp M       &kp W       &kp E       &ac_aacu    &kp K       \
                           &ac_iacu    &tc_zmk     >;
        };
        THUMB_MACRO(tc_que,     &kp U &ac_ecir)
        THUMB_MACRO(tc_cdiloe,  &ac_otil &kp E)
        THUMB_MACRO(tc_smart_i, &kp BACKSPACE &kp LS(I) &kp QUOT &kp SPACE)
        THUMB_MACRO(tc_qmk,     &kp BACKSPACE &kp LS(Q) &kp LS(M) &kp LS(K))
        THUMB_MACRO(tc_zmk,     &kp BACKSPACE &kp LS(Z) &kp LS(M) &kp LS(K))
    };
};